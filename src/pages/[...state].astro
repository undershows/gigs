---
import type { CollectionEntry } from "astro:content";
import { getCollection, getEntryBySlug } from "astro:content";

import Layout from "@/layouts/Layout.astro";

export type Props = {
  states: CollectionEntry<"state">[];
  currentState: CollectionEntry<"state">;
};

export async function getStaticPaths() {
  const states = await getCollection("state");
  const filteredStates = states.filter(
    (state) => state.slug !== import.meta.env.APP_MAIN_STATE
  );

  const mainState = await getEntryBySlug(
    "state",
    import.meta.env.APP_MAIN_STATE
  );

  return [
    {
      params: { state: undefined },
      props: { states, currentState: mainState },
    },
    ...filteredStates.map((state) => ({
      params: { state: state.slug },
      props: { states, currentState: state },
    })),
  ];
}

const { states, currentState } = Astro.props;
const title = `${import.meta.env.APP_SITE_TITLE} | ${currentState.data.name}`;
---

<Layout title={title} description={import.meta.env.APP_SITE_DESCRIPTION} />

<style lang="postcss">
  body {
    background-image: url("/images/bg/2.jpg");
    background-size: cover;
  }
</style>
